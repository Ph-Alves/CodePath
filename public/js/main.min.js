class CodePathApp{constructor(){this.sidebar=null;this.sidebarOverlay=null;this.sidebarToggleBtn=null;this.sidebarCloseBtn=null;this.notificationBtn=null;this.notificationDropdown=null;this.userMenuBtn=null;this.userMenuDropdown=null;this.init();}init(){if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>this.setup());}else{this.setup();}}setup(){this.cacheElements();this.bindEvents();this.setupSidebar();this.setupDropdowns();this.setupKeyboardNavigation();this.setupAccessibility();console.log('CodePath App initialized successfully');}cacheElements(){this.sidebar=document.getElementById('sidebar');this.sidebarOverlay=document.getElementById('sidebarOverlay');this.sidebarToggleBtn=document.getElementById('sidebarToggle');this.sidebarCloseBtn=document.getElementById('sidebarClose');this.notificationBtn=document.getElementById('notificationBtn');this.notificationDropdown=document.getElementById('notificationDropdown');this.userMenuBtn=document.getElementById('userMenuBtn');this.userMenuDropdown=document.getElementById('userMenuDropdown');this.navLinks=document.querySelectorAll('.nav-link');}bindEvents(){if(this.sidebarToggleBtn){this.sidebarToggleBtn.addEventListener('click',(e)=>{e.preventDefault();this.toggleSidebar();});}if(this.sidebarCloseBtn){this.sidebarCloseBtn.addEventListener('click',(e)=>{e.preventDefault();this.closeSidebar();});}if(this.sidebarOverlay){this.sidebarOverlay.addEventListener('click',()=>{this.closeSidebar();});}if(this.notificationBtn){this.notificationBtn.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();this.toggleNotificationDropdown();});}if(this.userMenuBtn){this.userMenuBtn.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();this.toggleUserMenuDropdown();});}document.addEventListener('click',(e)=>{this.handleGlobalClick(e);});window.addEventListener('resize',()=>{this.handleResize();});document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){this.handleEscapeKey();}});}setupSidebar(){if(!this.sidebar)return;this.setActiveNavLink();this.navLinks.forEach(link=>{link.addEventListener('mouseenter',()=>{this.handleNavLinkHover(link,!0);});link.addEventListener('mouseleave',()=>{this.handleNavLinkHover(link,!1);});link.addEventListener('click',(e)=>{this.createRippleEffect(e,link);});});this.initializeDynamicBadges();this.startBadgeUpdates();}setupDropdowns(){if(this.notificationDropdown){this.setupNotificationDropdown();}if(this.userMenuDropdown){this.setupUserMenuDropdown();}}setupNotificationDropdown(){const markAllReadBtn=this.notificationDropdown.querySelector('.mark-all-read');if(markAllReadBtn){markAllReadBtn.addEventListener('click',(e)=>{e.preventDefault();this.markAllNotificationsRead();});}const notificationItems=this.notificationDropdown.querySelectorAll('.notification-item');notificationItems.forEach(item=>{item.addEventListener('click',()=>{this.handleNotificationClick(item);});});}setupUserMenuDropdown(){const menuLinks=this.userMenuDropdown.querySelectorAll('.user-menu-link:not(.logout-link)');menuLinks.forEach(link=>{link.addEventListener('click',()=>{this.closeUserMenuDropdown();});});}setupKeyboardNavigation(){this.navLinks.forEach((link,index)=>{link.addEventListener('keydown',(e)=>{this.handleNavKeydown(e,index);});});}setupAccessibility(){if(this.notificationBtn){const badge=this.notificationBtn.querySelector('.notification-badge');const count=badge?badge.textContent:'0';this.notificationBtn.setAttribute('aria-label',`Notificações${count!=='0'?`(${count}não lidas)`:''}`);}if(this.notificationBtn){this.notificationBtn.setAttribute('aria-expanded','!1');}if(this.userMenuBtn){this.userMenuBtn.setAttribute('aria-expanded','!1');}}toggleSidebar(){if(!this.sidebar)return;const isOpen=this.sidebar.classList.contains('active');if(isOpen){this.closeSidebar();}else{this.openSidebar();}}openSidebar(){if(!this.sidebar)return;this.sidebar.classList.add('active');if(this.sidebarOverlay){this.sidebarOverlay.classList.add('active');}document.body.style.overflow='hidden';const firstLink=this.sidebar.querySelector('.nav-link');if(firstLink){setTimeout(()=>firstLink.focus(),100);}}closeSidebar(){if(!this.sidebar)return;this.sidebar.classList.remove('active');if(this.sidebarOverlay){this.sidebarOverlay.classList.remove('active');}document.body.style.overflow='';if(this.sidebarToggleBtn){this.sidebarToggleBtn.focus();}}toggleNotificationDropdown(){if(!this.notificationDropdown)return;const isOpen=this.notificationDropdown.classList.contains('active');this.closeUserMenuDropdown();if(isOpen){this.closeNotificationDropdown();}else{this.openNotificationDropdown();}}openNotificationDropdown(){if(!this.notificationDropdown)return;this.notificationDropdown.classList.add('active');if(this.notificationBtn){this.notificationBtn.setAttribute('aria-expanded','!0');}const firstItem=this.notificationDropdown.querySelector('.notification-item,.mark-all-read');if(firstItem){setTimeout(()=>firstItem.focus(),100);}}closeNotificationDropdown(){if(!this.notificationDropdown)return;this.notificationDropdown.classList.remove('active');if(this.notificationBtn){this.notificationBtn.setAttribute('aria-expanded','!1');}}toggleUserMenuDropdown(){if(!this.userMenuDropdown)return;const isOpen=this.userMenuDropdown.classList.contains('active');this.closeNotificationDropdown();if(isOpen){this.closeUserMenuDropdown();}else{this.openUserMenuDropdown();}}openUserMenuDropdown(){if(!this.userMenuDropdown)return;this.userMenuDropdown.classList.add('active');if(this.userMenuBtn){this.userMenuBtn.setAttribute('aria-expanded','!0');}const firstLink=this.userMenuDropdown.querySelector('.user-menu-link');if(firstLink){setTimeout(()=>firstLink.focus(),100);}}closeUserMenuDropdown(){if(!this.userMenuDropdown)return;this.userMenuDropdown.classList.remove('active');if(this.userMenuBtn){this.userMenuBtn.setAttribute('aria-expanded','!1');}}setActiveNavLink(){const currentPath=window.location.pathname;this.navLinks.forEach(link=>{link.classList.remove('active');});const activeLink=Array.from(this.navLinks).find(link=>{const linkPath=new URL(link.href).pathname;return currentPath===linkPath||(linkPath!=='/'&&currentPath.startsWith(linkPath));});if(activeLink){activeLink.classList.add('active');this.addActiveIndicator(activeLink);}}addActiveIndicator(link){document.querySelectorAll('.nav-active-indicator').forEach(indicator=>{indicator.remove();});const indicator=document.createElement('div');indicator.className='nav-active-indicator';indicator.style.cssText=` position:absolute;left:-4px;top:50%;transform:translateY(-50%);width:4px;height:60%;background:white;border-radius:0 2px 2px 0;animation:slideIn 0.3s ease-out;`;link.style.position='relative';link.appendChild(indicator);}handleNavLinkHover(link,isHover){const icon=link.querySelector('.nav-icon');const badge=link.querySelector('.nav-badge');if(isHover){link.classList.add('nav-link-hover');if(icon){icon.style.transform='scale(1.1)rotate(5deg)';}if(badge&&!badge.classList.contains('pulse')){badge.style.transform='scale(1.1)';}this.showTooltip(link);}else{link.classList.remove('nav-link-hover');if(icon){icon.style.transform='';}if(badge&&!badge.classList.contains('pulse')){badge.style.transform='';}this.hideTooltip();}}showTooltip(link){const title=link.getAttribute('title');if(!title)return;let tooltip=document.getElementById('nav-tooltip');if(!tooltip){tooltip=document.createElement('div');tooltip.id='nav-tooltip';tooltip.style.cssText=` position:fixed;background:rgba(0,0,0,0.8);color:white;padding:8px 12px;border-radius:6px;font-size:12px;z-index:10000;pointer-events:none;opacity:0;transition:opacity 0.2s ease;`;document.body.appendChild(tooltip);}tooltip.textContent=title;const rect=link.getBoundingClientRect();tooltip.style.left=`${rect.right+10}px`;tooltip.style.top=`${rect.top+rect.height/2-tooltip.offsetHeight/2}px`;tooltip.style.opacity='1';}hideTooltip(){const tooltip=document.getElementById('nav-tooltip');if(tooltip){tooltip.style.opacity='0';setTimeout(()=>{if(tooltip.parentNode){tooltip.parentNode.removeChild(tooltip);}},200);}}handleGlobalClick(e){if(this.notificationDropdown&&!this.notificationBtn.contains(e.target)&&!this.notificationDropdown.contains(e.target)){this.closeNotificationDropdown();}if(this.userMenuDropdown&&!this.userMenuBtn.contains(e.target)&&!this.userMenuDropdown.contains(e.target)){this.closeUserMenuDropdown();}}handleResize(){if(window.innerWidth>767){this.closeSidebar();}this.closeNotificationDropdown();this.closeUserMenuDropdown();}handleEscapeKey(){this.closeSidebar();this.closeNotificationDropdown();this.closeUserMenuDropdown();}handleNavKeydown(e,currentIndex){let targetIndex=currentIndex;switch(e.key){case 'ArrowDown':e.preventDefault();targetIndex=(currentIndex+1)%this.navLinks.length;break;case 'ArrowUp':e.preventDefault();targetIndex=currentIndex===0?this.navLinks.length-1:currentIndex-1;break;case 'Home':e.preventDefault();targetIndex=0;break;case 'End':e.preventDefault();targetIndex=this.navLinks.length-1;break;default:return;}this.navLinks[targetIndex].focus();}markAllNotificationsRead(){const unreadItems=this.notificationDropdown.querySelectorAll('.notification-item.unread');unreadItems.forEach(item=>{item.classList.remove('unread');});const badge=this.notificationBtn.querySelector('.notification-badge');if(badge){badge.style.display='none';}this.notificationBtn.setAttribute('aria-label','Notificações');console.log('Todas as notificações foram marcadas como lidas');}handleNotificationClick(item){if(item.classList.contains('unread')){item.classList.remove('unread');const badge=this.notificationBtn.querySelector('.notification-badge');if(badge){let count=parseInt(badge.textContent)-1;if(count<=0){badge.style.display='none';}else{badge.textContent=count;}}}console.log('Notificação clicada:',item);}showLoading(element){if(!element)return;element.classList.add('loading');const spinner=document.createElement('div');spinner.className='spinner';element.appendChild(spinner);}hideLoading(element){if(!element)return;element.classList.remove('loading');const spinner=element.querySelector('.spinner');if(spinner){spinner.remove();}}showToast(message,type='info',duration=3000){const toast=document.createElement('div');toast.className=`toast toast-${type}`;toast.textContent=message;Object.assign(toast.style,{position:'fixed',top:'20px',right:'20px',padding:'12px 24px',borderRadius:'8px',color:'white',fontWeight:'500',zIndex:'9999',transform:'translateX(100%)',transition:'transform 0.3s ease-in-out',backgroundColor:type==='success'?'#10B981':type==='error'?'#EF4444':type==='warning'?'#F59E0B':'#3B82F6'});document.body.appendChild(toast);setTimeout(()=>{toast.style.transform='translateX(0)';},100);setTimeout(()=>{toast.style.transform='translateX(100%)';setTimeout(()=>{if(toast.parentNode){toast.parentNode.removeChild(toast);}},300);},duration);}initializeDynamicBadges(){this.badgeData={pendingTasks:0,recentProgress:0,newAchievements:0,unreadMessages:0,securityAlerts:0};this.loadBadgeData();}async loadBadgeData(){try{const mockData=await this.simulateBadgeAPI();this.badgeData={...this.badgeData,...mockData};this.updateAllBadges();}catch(error){console.warn('Erro ao carregar dados dos badges:',error);}}async simulateBadgeAPI(){return new Promise((resolve)=>{setTimeout(()=>{const currentHour=new Date().getHours();const isActiveTime=currentHour>=9&&currentHour<=22;resolve({pendingTasks:Math.random()<0.3?Math.floor(Math.random()*5)+1:0,recentProgress:isActiveTime&&Math.random()<0.4?Math.floor(Math.random()*50)+10:0,newAchievements:Math.random()<0.1?Math.floor(Math.random()*3)+1:0,unreadMessages:Math.random()<0.2?Math.floor(Math.random()*8)+1:0,securityAlerts:Math.random()<0.05?Math.floor(Math.random()*2)+1:0});},500);});}updateAllBadges(){this.updateBadge('dashboard','pendingTasks',this.badgeData.pendingTasks,'pulse');this.updateBadge('progress','recentProgress',this.badgeData.recentProgress,'success');this.updateBadge('achievements','newAchievements',this.badgeData.newAchievements,'achievement-badge');this.updateBadge('chat','unreadMessages',this.badgeData.unreadMessages,'message-badge pulse');this.updateBadge('security','securityAlerts',this.badgeData.securityAlerts,'alert-badge pulse');}updateBadge(section,dataKey,value,badgeClasses=''){const navLink=document.querySelector(`a[href*="/${section}"]`);if(!navLink)return;let badge=navLink.querySelector('.nav-badge');if(value>0){if(!badge){badge=document.createElement('span');badge.className=`nav-badge ${badgeClasses}`;navLink.appendChild(badge);}else{badge.className=`nav-badge ${badgeClasses}`;}let displayValue=value;if(dataKey==='recentProgress'){displayValue=`+${value}`;}else if(value>99){displayValue='99+';}badge.textContent=displayValue;badge.style.display='inline-block';badge.style.animation='none';setTimeout(()=>{badge.style.animation=badgeClasses.includes('pulse')?'pulse 2s infinite':'';},100);}else if(badge){badge.style.animation='fadeOut 0.3s ease-out';setTimeout(()=>{if(badge.parentNode){badge.parentNode.removeChild(badge);}},300);}}startBadgeUpdates(){this.badgeUpdateInterval=setInterval(()=>{this.loadBadgeData();},30000);document.addEventListener('visibilitychange',()=>{if(document.hidden){if(this.badgeUpdateInterval){clearInterval(this.badgeUpdateInterval);}}else{this.startBadgeUpdates();this.loadBadgeData();}});}createRippleEffect(event,element){const ripple=document.createElement('span');const rect=element.getBoundingClientRect();const size=Math.max(rect.width,rect.height);const x=event.clientX-rect.left-size/2;const y=event.clientY-rect.top-size/2;ripple.style.cssText=` position:absolute;width:${size}px;height:${size}px;left:${x}px;top:${y}px;background:rgba(255,255,255,0.3);border-radius:50%;transform:scale(0);animation:ripple 0.6s ease-out;pointer-events:none;z-index:1;`;element.style.position='relative';element.style.overflow='hidden';element.appendChild(ripple);setTimeout(()=>{if(ripple.parentNode){ripple.parentNode.removeChild(ripple);}},600);}}const app=new CodePathApp();window.CodePathApp=app;window.showToast=(message,type,duration)=>app.showToast(message,type,duration);window.showLoading=(element)=>app.showLoading(element);window.hideLoading=(element)=>app.hideLoading(element);