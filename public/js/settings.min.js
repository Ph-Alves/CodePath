class SettingsManager{constructor(){this.currentTab='profile';this.formValidators={};this.isDirty=!1;this.init();}init(){this.setupTabNavigation();this.setupFormValidation();this.setupToggleSwitches();this.setupPhotoUpload();this.setupAutoSave();this.setupFormDirtyTracking();this.setupKeyboardShortcuts();}setupTabNavigation(){const tabs=document.querySelectorAll('.settings-tab');const tabContents=document.querySelectorAll('.settings-tab-content');tabs.forEach(tab=>{tab.addEventListener('click',(e)=>{e.preventDefault();const targetTab=tab.dataset.tab;this.switchTab(targetTab,tabs,tabContents);});});document.addEventListener('keydown',(e)=>{if(e.ctrlKey&&e.key>='1'&&e.key<='5'){e.preventDefault();const tabIndex=parseInt(e.key)-1;const tab=tabs[tabIndex];if(tab){tab.click();}}});}switchTab(targetTab,tabs,tabContents){if(this.isDirty&&this.currentTab!==targetTab){if(!confirm('Você tem alterações não salvas. Deseja continuar?')){return;}}tabs.forEach(tab=>tab.classList.remove('active'));tabContents.forEach(content=>content.classList.remove('active'));const activeTab=document.querySelector(`[data-tab="${targetTab}"]`);const activeContent=document.getElementById(`${targetTab}-tab`);if(activeTab&&activeContent){activeTab.classList.add('active');activeContent.classList.add('active');this.currentTab=targetTab;this.isDirty=!1;activeContent.style.animation='none';activeContent.offsetHeight;activeContent.style.animation='fadeInUp 0.4s ease-out';}}setupFormValidation(){this.setupProfileValidation();this.setupSecurityValidation();this.setupNotificationValidation();}setupProfileValidation(){const form=document.getElementById('profileForm');if(!form)return;const nameInput=document.getElementById('userName');const emailInput=document.getElementById('userEmail');const bioInput=document.getElementById('userBio');if(nameInput){nameInput.addEventListener('blur',()=>{this.validateName(nameInput);});nameInput.addEventListener('input',()=>{if(nameInput.classList.contains('is-invalid')){setTimeout(()=>this.validateName(nameInput),300);}this.markFormDirty();});}if(emailInput){emailInput.addEventListener('blur',()=>{this.validateEmail(emailInput);});emailInput.addEventListener('input',()=>{if(emailInput.classList.contains('is-invalid')){setTimeout(()=>this.validateEmail(emailInput),300);}this.markFormDirty();});}if(bioInput){bioInput.addEventListener('input',()=>{this.validateBio(bioInput);this.markFormDirty();});}form.addEventListener('submit',(e)=>{e.preventDefault();this.submitProfileForm(form);});}setupSecurityValidation(){const form=document.getElementById('securityForm');if(!form)return;const currentPasswordInput=document.getElementById('currentPassword');const newPasswordInput=document.getElementById('newPassword');const confirmPasswordInput=document.getElementById('confirmPassword');if(currentPasswordInput){currentPasswordInput.addEventListener('blur',()=>{this.validateCurrentPassword(currentPasswordInput);});}if(newPasswordInput){newPasswordInput.addEventListener('blur',()=>{this.validateNewPassword(newPasswordInput);});newPasswordInput.addEventListener('input',()=>{if(confirmPasswordInput.value){this.validateConfirmPassword(confirmPasswordInput,newPasswordInput.value);}this.markFormDirty();});}if(confirmPasswordInput){confirmPasswordInput.addEventListener('blur',()=>{this.validateConfirmPassword(confirmPasswordInput,newPasswordInput.value);});confirmPasswordInput.addEventListener('input',()=>{this.validateConfirmPassword(confirmPasswordInput,newPasswordInput.value);this.markFormDirty();});}form.addEventListener('submit',(e)=>{e.preventDefault();this.submitSecurityForm(form);});}setupNotificationValidation(){const form=document.getElementById('notificationsForm');if(!form)return;const toggles=form.querySelectorAll('.toggle-input');toggles.forEach(toggle=>{toggle.addEventListener('change',()=>{this.markFormDirty();});});form.addEventListener('submit',(e)=>{e.preventDefault();this.submitNotificationsForm(form);});}validateName(input){const name=input.value.trim();if(!name){this.showFieldError(input,'Nome é obrigatório');return !1;}if(name.length<2){this.showFieldError(input,'Nome deve ter pelo menos 2 caracteres');return !1;}if(!/^[a-zA-ZÀ-ÿ\s]+$/.test(name)){this.showFieldError(input,'Nome deve conter apenas letras');return !1;}this.showFieldSuccess(input,'Nome válido');return !0;}validateEmail(input){const email=input.value.trim();const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!email){this.showFieldError(input,'Email é obrigatório');return !1;}if(!emailRegex.test(email)){this.showFieldError(input,'Por favor,insira um email válido');return !1;}this.showFieldSuccess(input,'Email válido');return !0;}validateBio(input){const bio=input.value;const maxLength=500;if(bio.length>maxLength){this.showFieldError(input,`Bio deve ter no máximo ${maxLength}caracteres`);return !1;}if(bio.length>0){this.showFieldSuccess(input,`${bio.length}/${maxLength}caracteres`);}else{this.clearFieldFeedback(input);}return !0;}validateCurrentPassword(input){const password=input.value;if(!password){this.showFieldError(input,'Senha atual é obrigatória');return !1;}this.clearFieldFeedback(input);return !0;}validateNewPassword(input){const password=input.value;if(!password){this.showFieldError(input,'Nova senha é obrigatória');return !1;}if(password.length<6){this.showFieldError(input,'Nova senha deve ter pelo menos 6 caracteres');return !1;}const strength=this.calculatePasswordStrength(password);if(strength<3){this.showFieldError(input,'Senha muito fraca. Use letras,números e símbolos');return !1;}this.showFieldSuccess(input,'Senha forte');return !0;}validateConfirmPassword(input,newPassword){const confirmPassword=input.value;if(!confirmPassword){this.showFieldError(input,'Confirmação de senha é obrigatória');return !1;}if(confirmPassword!==newPassword){this.showFieldError(input,'As senhas não coincidem');return !1;}this.showFieldSuccess(input,'Senhas coincidem');return !0;}calculatePasswordStrength(password){let strength=0;if(password.length>=8)strength++;if(/[a-z]/.test(password))strength++;if(/[A-Z]/.test(password))strength++;if(/[0-9]/.test(password))strength++;if(/[^A-Za-z0-9]/.test(password))strength++;return strength;}showFieldError(input,message){const feedback=this.getOrCreateFeedback(input);feedback.textContent=message;feedback.className='form-feedback invalid-feedback';input.classList.remove('is-valid');input.classList.add('is-invalid');}showFieldSuccess(input,message){const feedback=this.getOrCreateFeedback(input);feedback.textContent=message;feedback.className='form-feedback valid-feedback';input.classList.remove('is-invalid');input.classList.add('is-valid');}clearFieldFeedback(input){const feedback=this.getOrCreateFeedback(input);feedback.textContent='';input.classList.remove('is-valid','is-invalid');}getOrCreateFeedback(input){let feedback=input.parentNode.querySelector('.form-feedback');if(!feedback){feedback=document.createElement('div');feedback.className='form-feedback';input.parentNode.appendChild(feedback);}return feedback;}setupToggleSwitches(){const toggleGroups=document.querySelectorAll('.toggle-group');toggleGroups.forEach(group=>{const input=group.querySelector('.toggle-input');const slider=group.querySelector('.toggle-slider');if(input&&slider){slider.addEventListener('click',()=>{input.checked=!input.checked;input.dispatchEvent(new Event('change'));this.animateToggle(slider,input.checked);});input.addEventListener('keydown',(e)=>{if(e.key===' '||e.key==='Enter'){e.preventDefault();slider.click();}});}});}animateToggle(slider,isChecked){slider.style.transform=isChecked?'scale(1.1)':'scale(0.95)';setTimeout(()=>{slider.style.transform='scale(1)';},150);}setupPhotoUpload(){const uploadBtn=document.getElementById('uploadPhoto');const removeBtn=document.getElementById('removePhoto');const photoImg=document.querySelector('.profile-photo');if(uploadBtn){uploadBtn.addEventListener('click',()=>{this.openFileDialog();});}if(removeBtn){removeBtn.addEventListener('click',()=>{this.removeProfilePhoto();});}if(photoImg){this.setupPhotoDragDrop(photoImg);}}openFileDialog(){const input=document.createElement('input');input.type='file';input.accept='image/*';input.addEventListener('change',(e)=>{const file=e.target.files[0];if(file){this.handlePhotoUpload(file);}});input.click();}handlePhotoUpload(file){if(!file.type.startsWith('image/')){this.showToast('Por favor,selecione apenas arquivos de imagem','error');return;}if(file.size>5*1024*1024){this.showToast('A imagem deve ter no máximo 5MB','error');return;}const reader=new FileReader();reader.onload=(e)=>{const photoImg=document.querySelector('.profile-photo');if(photoImg){photoImg.src=e.target.result;this.markFormDirty();this.showToast('Foto atualizada com sucesso','success');}};reader.readAsDataURL(file);}setupPhotoDragDrop(photoElement){const container=photoElement.closest('.profile-photo-section');['dragenter','dragover','dragleave','drop'].forEach(eventName=>{container.addEventListener(eventName,(e)=>{e.preventDefault();e.stopPropagation();});});['dragenter','dragover'].forEach(eventName=>{container.addEventListener(eventName,()=>{container.classList.add('drag-hover');});});['dragleave','drop'].forEach(eventName=>{container.addEventListener(eventName,()=>{container.classList.remove('drag-hover');});});container.addEventListener('drop',(e)=>{const files=e.dataTransfer.files;if(files.length>0){this.handlePhotoUpload(files[0]);}});}removeProfilePhoto(){const photoImg=document.querySelector('.profile-photo');if(photoImg){photoImg.src='/images/default-avatar.png';this.markFormDirty();this.showToast('Foto removida','info');}}setupAutoSave(){setInterval(()=>{if(this.isDirty){this.autoSaveCurrentForm();}},30000);}setupFormDirtyTracking(){const inputs=document.querySelectorAll('input,textarea,select');inputs.forEach(input=>{input.addEventListener('input',()=>{this.markFormDirty();});input.addEventListener('change',()=>{this.markFormDirty();});});window.addEventListener('beforeunload',(e)=>{if(this.isDirty){e.preventDefault();e.returnValue='Você tem alterações não salvas. Deseja sair mesmo assim?';return e.returnValue;}});}markFormDirty(){this.isDirty=!0;this.updateSaveButton();}markFormClean(){this.isDirty=!1;this.updateSaveButton();}updateSaveButton(){const saveBtn=document.getElementById('saveAllSettings');if(saveBtn){if(this.isDirty){saveBtn.textContent='Salvar Alterações';saveBtn.classList.add('pulse');}else{saveBtn.textContent='Salvar Todas';saveBtn.classList.remove('pulse');}}}autoSaveCurrentForm(){const activeTab=document.querySelector('.settings-tab-content.active');if(!activeTab)return;const form=activeTab.querySelector('form');if(form){this.saveFormData(form,!0);}}async submitProfileForm(form){const submitBtn=form.querySelector('button[type="submit"]');const nameInput=document.getElementById('userName');const emailInput=document.getElementById('userEmail');let isValid=!0;if(!this.validateName(nameInput))isValid=!1;if(!this.validateEmail(emailInput))isValid=!1;if(!isValid){this.showToast('Por favor,corrija os erros antes de continuar','error');return;}this.setButtonLoading(submitBtn,!0);try{await this.simulateApiCall();this.showToast('Perfil atualizado com sucesso','success');this.markFormClean();}catch(error){this.showToast('Erro ao atualizar perfil. Tente novamente.','error');}finally{this.setButtonLoading(submitBtn,!1);}}async submitSecurityForm(form){const submitBtn=form.querySelector('button[type="submit"]');const currentPasswordInput=document.getElementById('currentPassword');const newPasswordInput=document.getElementById('newPassword');const confirmPasswordInput=document.getElementById('confirmPassword');let isValid=!0;if(!this.validateCurrentPassword(currentPasswordInput))isValid=!1;if(!this.validateNewPassword(newPasswordInput))isValid=!1;if(!this.validateConfirmPassword(confirmPasswordInput,newPasswordInput.value))isValid=!1;if(!isValid){this.showToast('Por favor,corrija os erros antes de continuar','error');return;}this.setButtonLoading(submitBtn,!0);try{await this.simulateApiCall();this.showToast('Senha alterada com sucesso','success');form.reset();this.markFormClean();}catch(error){this.showToast('Erro ao alterar senha. Tente novamente.','error');}finally{this.setButtonLoading(submitBtn,!1);}}async submitNotificationsForm(form){const submitBtn=form.querySelector('button[type="submit"]');this.setButtonLoading(submitBtn,!0);try{await this.simulateApiCall();this.showToast('Preferências de notificação atualizadas','success');this.markFormClean();}catch(error){this.showToast('Erro ao atualizar preferências. Tente novamente.','error');}finally{this.setButtonLoading(submitBtn,!1);}}setButtonLoading(button,isLoading){if(isLoading){button.classList.add('loading');button.disabled=!0;}else{button.classList.remove('loading');button.disabled=!1;}}async simulateApiCall(){return new Promise((resolve)=>{setTimeout(resolve,1000+Math.random()*1000);});}showToast(message,type='info'){const toast=document.createElement('div');toast.className=`toast ${type}`;toast.innerHTML=`<div class="toast-content"><span class="toast-icon">${this.getToastIcon(type)}</span><span class="toast-message">${message}</span></div>`;document.body.appendChild(toast);setTimeout(()=>toast.classList.add('show'),100);setTimeout(()=>{toast.classList.remove('show');setTimeout(()=>document.body.removeChild(toast),300);},4000);}getToastIcon(type){const icons={success:'✅',error:'❌',warning:'⚠️',info:'ℹ️'};return icons[type]||icons.info;}setupKeyboardShortcuts(){document.addEventListener('keydown',(e)=>{if(e.ctrlKey&&e.key==='s'){e.preventDefault();const activeForm=document.querySelector('.settings-tab-content.active form');if(activeForm){activeForm.dispatchEvent(new Event('submit'));}}if(e.key==='Escape'){const focusedInput=document.activeElement;if(focusedInput&&focusedInput.matches('input,textarea')){this.clearFieldFeedback(focusedInput);}}});}}document.addEventListener('DOMContentLoaded',()=>{new SettingsManager();});const toastStyles=` .toast{position:fixed;top:2rem;right:2rem;background:white;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.15);padding:1rem 1.5rem;z-index:10000;transform:translateX(400px);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);border-left:4px solid var(--primary-purple);max-width:400px;}.toast.show{transform:translateX(0);}.toast-content{display:flex;align-items:center;gap:0.75rem;}.toast-icon{font-size:1.2rem;flex-shrink:0;}.toast-message{color:var(--gray-700);font-weight:500;line-height:1.4;}.toast.success{border-left-color:var(--success-green);}.toast.error{border-left-color:var(--error-red);}.toast.warning{border-left-color:var(--warning-yellow);}.toast.info{border-left-color:var(--info-blue);}.profile-photo-section.drag-hover{border-color:var(--primary-purple);background:rgba(139,92,246,0.1);transform:scale(1.02);}.btn.pulse{animation:pulse 2s infinite;}@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}@media(max-width:768px){.toast{top:1rem;right:1rem;left:1rem;max-width:none;transform:translateY(-100px);}.toast.show{transform:translateY(0);}}`;const styleSheet=document.createElement('style');styleSheet.textContent=toastStyles;document.head.appendChild(styleSheet);