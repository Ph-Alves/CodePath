class LessonProgressManager{constructor(){this.init();}init(){this.bindEvents();this.checkLessonStatus();}bindEvents(){const markCompleteBtn=document.getElementById('markCompleteBtn');if(markCompleteBtn){markCompleteBtn.addEventListener('click',(e)=>{e.preventDefault();this.markLessonComplete(markCompleteBtn.dataset.lessonId);});}const playButton=document.getElementById('playButton');if(playButton){playButton.addEventListener('click',()=>{this.handleVideoPlay();});}}async checkLessonStatus(){try{const lessonId=this.getCurrentLessonId();if(!lessonId)return;const response=await fetch(`/content/api/lesson/${lessonId}/status`);const data=await response.json();if(data.success){this.updateLessonUI(data.data);}}catch(error){console.error('Erro ao verificar status da aula:',error);}}async markLessonComplete(lessonId){try{const markCompleteBtn=document.getElementById('markCompleteBtn');markCompleteBtn.disabled=!0;markCompleteBtn.innerHTML=`<i class="icon-loader" aria-hidden="!0"></i>Processando... `;const response=await fetch(`/content/lesson/${lessonId}/complete`,{method:'POST',headers:{'Content-Type':'application/json',}});const data=await response.json();if(data.success){this.handleLessonCompleted(data);}else{this.handleLessonError(data);}}catch(error){console.error('Erro ao marcar aula como conclu√≠da:',error);this.showNotification('Erro ao marcar aula como conclu√≠da','error');this.resetMarkCompleteButton();}}handleLessonCompleted(data){this.showNotification(data.message,'success');if(data.xp_gained){this.showXPGained(data.xp_gained);}if(data.leveled_up){this.showLevelUp(data.new_level);}this.updateMarkCompleteButton(!0);if(data.progress_stats){this.updateProgressBar(data.progress_stats.progress_percentage);}this.updateUserMetrics(data);const lessonCompletedEvent=new CustomEvent('lessonCompleted',{detail:{lessonId:this.getCurrentLessonId(),xpGained:data.xp_gained,leveledUp:data.leveled_up,newLevel:data.new_level,nextLesson:data.nextLesson,progressStats:data.progress_stats}});document.dispatchEvent(lessonCompletedEvent);}handleLessonError(data){if(data.already_completed){this.showNotification('Esta aula j√° foi conclu√≠da anteriormente','info');this.updateMarkCompleteButton(!0);}else{this.showNotification(data.message||'Erro ao marcar aula como conclu√≠da','error');this.resetMarkCompleteButton();}}updateLessonUI(lessonData){this.updateMarkCompleteButton(lessonData.is_completed);this.updateProgressBar(lessonData.progress_percentage);this.updateProgressInfo(lessonData);}updateMarkCompleteButton(isCompleted){const markCompleteBtn=document.getElementById('markCompleteBtn');if(!markCompleteBtn)return;if(isCompleted){markCompleteBtn.innerHTML=`<i class="icon-check" aria-hidden="!0"></i>Aula Conclu√≠da `;markCompleteBtn.disabled=!0;markCompleteBtn.classList.add('btn-success');markCompleteBtn.classList.remove('btn-primary');}else{markCompleteBtn.innerHTML=`<i class="icon-check" aria-hidden="!0"></i>Marcar como Conclu√≠da `;markCompleteBtn.disabled=!1;markCompleteBtn.classList.add('btn-primary');markCompleteBtn.classList.remove('btn-success');}}resetMarkCompleteButton(){const markCompleteBtn=document.getElementById('markCompleteBtn');if(!markCompleteBtn)return;markCompleteBtn.disabled=!1;markCompleteBtn.innerHTML=`<i class="icon-check" aria-hidden="!0"></i>Marcar como Conclu√≠da `;}updateProgressBar(percentage){const progressFill=document.querySelector('.progress-fill');const progressPercentage=document.querySelector('.progress-percentage');if(progressFill){progressFill.style.width=`${percentage}%`;}if(progressPercentage){progressPercentage.textContent=`${percentage}%`;}}showXPGained(xpAmount){const xpNotification=document.createElement('div');xpNotification.className='xp-notification';xpNotification.innerHTML=`<div class="xp-content"><i class="icon-star" aria-hidden="!0"></i><span>+${xpAmount}XP</span></div>`;document.body.appendChild(xpNotification);setTimeout(()=>{xpNotification.classList.add('show');},100);setTimeout(()=>{xpNotification.classList.remove('show');setTimeout(()=>{document.body.removeChild(xpNotification);},300);},3000);}showLevelUp(newLevel){const levelUpModal=document.createElement('div');levelUpModal.className='level-up-modal';levelUpModal.innerHTML=`<div class="level-up-content"><div class="level-up-icon">‚≠ê</div><h2>N√≠vel ${newLevel}Alcan√ßado!</h2><p>Parab√©ns!Voc√™ subiu de n√≠vel!</p><button class="btn btn-primary" onclick="this.parentElement.parentElement.remove()">Continuar</button></div>`;document.body.appendChild(levelUpModal);setTimeout(()=>{levelUpModal.classList.add('show');},100);}showNotification(message,type='info'){const notification=document.createElement('div');notification.className=`notification notification-${type}`;notification.innerHTML=`<div class="notification-content"><i class="notification-icon icon-${type}" aria-hidden="!0"></i><span class="notification-text">${message}</span><button class="notification-close" onclick="this.parentElement.parentElement.remove()"><i class="icon-x" aria-hidden="!0"></i></button></div>`;document.body.appendChild(notification);setTimeout(()=>{notification.classList.add('show');},100);setTimeout(()=>{if(notification.parentElement){notification.classList.remove('show');setTimeout(()=>{if(notification.parentElement){document.body.removeChild(notification);}},300);}},5000);}handleVideoPlay(){const playButton=document.getElementById('playButton');const videoOverlay=document.querySelector('.video-overlay');if(playButton&&videoOverlay){playButton.style.display='none';videoOverlay.innerHTML=`<div class="video-playing"><p>üé• Reproduzindo aula...</p><p><small>Simula√ß√£o de player de v√≠deo</small></p></div>`;}}updateUserMetrics(data){const userXP=document.querySelector('.user-xp');if(userXP&&data.xp_result){userXP.textContent=`${data.xp_result.total_xp}XP`;}const userLevel=document.querySelector('.user-level');if(userLevel&&data.xp_result){userLevel.textContent=`N√≠vel ${data.xp_result.new_level}`;}}getCurrentLessonId(){const markCompleteBtn=document.getElementById('markCompleteBtn');return markCompleteBtn?markCompleteBtn.dataset.lessonId:null;}updateProgressInfo(lessonData){const progressInfo=document.querySelector('.progress-info');if(progressInfo&&lessonData.lessons_watched){const progressLabel=progressInfo.querySelector('.progress-label');if(progressLabel){progressLabel.textContent=`Progresso do Pacote(${lessonData.lessons_watched}aulas assistidas)`;}}}}document.addEventListener('DOMContentLoaded',()=>{new LessonProgressManager();});window.LessonProgressManager=LessonProgressManager;