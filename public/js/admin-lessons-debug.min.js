console.log('ğŸš€[DEBUG]admin-lessons-debug.js carregado em:',new Date().toISOString());if(window.adminLessonsManager){console.log('âš ï¸[DEBUG]InstÃ¢ncia antiga encontrada,removendo...');delete window.adminLessonsManager;}const existingListeners=document.querySelectorAll('[data-admin-listener]');if(existingListeners.length>0){console.log('âš ï¸[DEBUG]Event listeners antigos encontrados:',existingListeners.length);existingListeners.forEach(el=>el.removeAttribute('data-admin-listener'));}const oldModals=document.querySelectorAll('.modal,.toast,.admin-notification');oldModals.forEach(el=>{console.log('ğŸ§¹[DEBUG]Removendo elemento antigo:',el.className);el.remove();});if(typeof bootstrap!=='undefined'){console.log('âš ï¸[DEBUG]Bootstrap detectado,versÃ£o:',bootstrap.Tooltip.VERSION);console.log('ğŸš«[DEBUG]IMPORTANTE:NÃƒO vamos usar Bootstrap Modal!');}class AdminLessonsManagerDebug{constructor(){console.log('ğŸ”§[DEBUG]Construtor chamado');this.lessons=[];this.packages=[];this.filteredLessons=[];this.isInitialized=!1;window.adminLessonsManager=this;this.init();}async init(){console.log('ğŸ”„[DEBUG]Inicializando...');if(this.isInitialized){console.log('âš ï¸[DEBUG]JÃ¡ inicializado,pulando...');return;}try{await this.loadPackages();await this.loadLessons();this.setupEventListeners();this.applyFilters();this.isInitialized=!0;console.log('âœ…[DEBUG]InicializaÃ§Ã£o completa!');}catch(error){console.error('âŒ[DEBUG]Erro na inicializaÃ§Ã£o:',error);}}async loadPackages(){console.log('ğŸ“¦[DEBUG]Carregando pacotes...');try{const response=await fetch('/admin/api/packages');const data=await response.json();this.packages=data.packages||[];console.log(`âœ…[DEBUG]${this.packages.length}pacotes carregados`);}catch(error){console.error('âŒ[DEBUG]Erro ao carregar pacotes:',error);}}async loadLessons(){console.log('ğŸ“š[DEBUG]Carregando aulas...');try{const response=await fetch('/admin/api/lessons');const data=await response.json();this.lessons=data.lessons||[];console.log(`âœ…[DEBUG]${this.lessons.length}aulas carregadas`);}catch(error){console.error('âŒ[DEBUG]Erro ao carregar aulas:',error);}}setupEventListeners(){console.log('ğŸ¯[DEBUG]Configurando event listeners...');document.addEventListener('click',(e)=>{console.log('ğŸ–±ï¸[DEBUG]Clique detectado em:',e.target);if(e.target.classList.contains('edit-lesson-btn')||e.target.closest('.edit-lesson-btn')){e.preventDefault();console.log('âœï¸[DEBUG]Clique em botÃ£o EDITAR detectado!');const btn=e.target.closest('.edit-lesson-btn')||e.target;const lessonId=parseInt(btn.dataset.lessonId);const lessonName=btn.dataset.lessonName;console.log('ğŸ“[DEBUG]Dados do botÃ£o:',{lessonId,lessonName});this.editLessonNameDebug(lessonId,lessonName);return;}if(e.target.classList.contains('delete-lesson-btn')||e.target.closest('.delete-lesson-btn')){e.preventDefault();console.log('ğŸ—‘ï¸[DEBUG]Clique em botÃ£o EXCLUIR detectado!');const btn=e.target.closest('.delete-lesson-btn')||e.target;const lessonId=parseInt(btn.dataset.lessonId);const lessonName=btn.dataset.lessonName;console.log('ğŸ“[DEBUG]Dados do botÃ£o:',{lessonId,lessonName});this.deleteLessonDebug(lessonId,lessonName);return;}});console.log('âœ…[DEBUG]Event listeners configurados');}async editLessonNameDebug(lessonId,currentName){console.log('âœï¸[DEBUG]MÃ‰TODO EDITAR CHAMADO:',lessonId,currentName);const newName=prompt(`[DEBUG]Editar nome da aula:\n\nNome atual:${currentName}\n\nDigite o novo nome:`,currentName);console.log('ğŸ“[DEBUG]Nome inserido:',newName);if(!newName||newName.trim()===''||newName===currentName){console.log('âŒ[DEBUG]EdiÃ§Ã£o cancelada');alert('[DEBUG]EdiÃ§Ã£o cancelada ou nome nÃ£o alterado');return;}try{const updateData={name:newName.trim()};console.log('ğŸ“¤[DEBUG]Enviando dados:',updateData);const response=await fetch(`/admin/api/lessons/${lessonId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(updateData)});const responseData=await response.json();console.log('ğŸ“¥[DEBUG]Resposta:',responseData);if(response.ok){alert(`[DEBUG]âœ… Sucesso:${responseData.message}`);location.reload();}else{alert(`[DEBUG]âŒ Erro:${responseData.message}`);}}catch(error){console.error('âŒ[DEBUG]Erro:',error);alert(`[DEBUG]âŒ Erro:${error.message}`);}}async deleteLessonDebug(lessonId,lessonName){console.log('ğŸ—‘ï¸[DEBUG]MÃ‰TODO EXCLUIR CHAMADO:',lessonId,lessonName);const confirmDelete=confirm(`[DEBUG]Tem certeza que deseja excluir?\n\n"${lessonName}"\n\nâš ï¸ Esta aÃ§Ã£o nÃ£o pode ser desfeita!`);if(!confirmDelete){console.log('ğŸš«[DEBUG]UsuÃ¡rio cancelou a exclusÃ£o');return;}try{console.log(`ğŸ—‘ï¸[DEBUG]Excluindo aula ${lessonId}...`);const response=await fetch(`/admin/api/lessons/${lessonId}`,{method:'DELETE'});const result=await response.json();console.log('âœ…[DEBUG]Resultado:',result);if(response.ok){alert(`[DEBUG]âœ… Sucesso:${result.message}`);location.reload();}else{alert(`[DEBUG]âŒ Erro:${result.message}`);}}catch(error){console.error('âŒ[DEBUG]Erro:',error);alert(`[DEBUG]âŒ Erro:${error.message}`);}}applyFilters(){console.log('ğŸ”[DEBUG]Aplicando filtros...');this.filteredLessons=this.lessons;}}console.log('ğŸ”[DEBUG]Configurando inicializaÃ§Ã£o...');function initializeAdminLessonsDebug(){if(window.adminLessonsManager){console.log('âœ…[DEBUG]InstÃ¢ncia jÃ¡ existe,nÃ£o duplicando');return;}console.log('ğŸš€[DEBUG]Criando nova instÃ¢ncia...');try{new AdminLessonsManagerDebug();}catch(error){console.error('âŒ[DEBUG]Erro na inicializaÃ§Ã£o:',error);}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initializeAdminLessonsDebug);}else{initializeAdminLessonsDebug();}console.log('ğŸ”[DEBUG]Arquivo de debug carregado completamente!');